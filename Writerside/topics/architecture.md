# Архитектура распределенного key-value хранилища 

<!--Writerside adds this topic when you create a new documentation project.
You can use it as a sandbox to play with Writerside features, and remove it from the TOC when you don't need it anymore.-->

## Основные свойства хранилища 
Разрабатываемое хранилище имеет следующие свойства:
- Тип key-value
- На основе LSM-дерева
- Поддержка персистентности
- Поддержка репликации данных
- Возможность встраиваемости


Два режима работы:

Встроенный режим (Embedded Mode)
 : Приложение использует LSM-хранилище напрямую, без участия репликационных механизмов.

Режим реплицированного хранилища (Distributed Mode):  
 : Клиентские операции (например, upsert) оборачиваются в команды (операции) RAFT и передаются через группу реплик.  
 : Решения RAFT (аппликация логов) вызывают обновление локального LSM-хранилища

![Create new topic options](new_topic_options.png){ width=290 }{border-effect=line}

## Цели и задачи
**Цель**: создание встраиваемого хранилища типа ключ-значение на основе LSM-дерева с поддержкой
механизма репликации на основе алгоритма распределенного консенсуса.

**Задачи**:
1. Разработать ядро хранилища с поддержкой таблиц в памяти
(Memtable), таблиц на диске (SSTable), слияния таблиц при
помощи алгоритма compaction, автоматический фоновый
flush, WAL
2. Проектирование архитектуры распределенной системы
3. Реализация структурных и алгоритмических улучшений для LSM-дерева
4. Реализация шардирования
5. Реализация репликации (RAFT)
6. Оценка производительности, профилирование, анализ
7. Тестирование (в том числе нагрузочное)
8. Разработка инструмента администрирования и
визуализации


## Разработка ядра хранилища

### Описание ядра

> **Ядро хранилища** представляет из себя реализацию на базе LSM-дерева с поддержкой следующих операций: 
- Получение записи (entry) по его ключу
- Получение упорядоченного итератора для всех записей, начиная с заданного ключа
- Получение упорядоченного итератора для всех записей, ключи которых меньше заданного 
- Получение упорядоченного итератора для всех записей, ключи которых находятся в заданных границах
- Получение упорядоченного итератора всех записей в базе
- Вставка записи
- Автоматический фоновый flush данных из памяти на диск по превышении порога
- Слияние таблиц (compaction)
- Использование WAL (Write-ahead log)

> **Запись (entry)** представляет из себя пару ключ-значение.

Язык реализации: Java 21.

<seealso>
    <category ref="lsm">
        <a href="https://github.com/axothy/lsm-dht">GitHub репозиторий хранилища</a>
    </category>
</seealso>